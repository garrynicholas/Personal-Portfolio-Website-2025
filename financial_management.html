<!doctype html>
<html lang="en">
<script>
// Check authentication before page loads
if (localStorage.getItem('isLoggedIn') !== 'true') {
    window.location.href = 'failed.html';
}
</script>
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Portfolio Manager - Financial Dashboard</title>
<!-- ApexCharts -->
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<style>
@import url("https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@200;400;500&display=swap");

:root {
    --primary: #6366f1;
    --secondary: #a855f7;
    --accent: #06b6d4;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --bg-dark: #0a0a0f;
    --bg-darker: #050507;
    --text-primary: #ffffff;
    --text-secondary: #a1a1aa;
    --glass-bg: rgba(255, 255, 255, 0.03);
    --glass-border: rgba(255, 255, 255, 0.08);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html {
    scroll-behavior: smooth;
}

body {
    font-family: "Space Grotesk", sans-serif;
    background: radial-gradient(ellipse at top, rgba(99, 102, 241, 0.1) 0%, var(--bg-darker) 50%), 
                radial-gradient(ellipse at bottom right, rgba(168, 85, 247, 0.08) 0%, transparent 50%),
                linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-darker) 100%);
    color: var(--text-primary);
    overflow-x: hidden;
    min-height: 100vh;
    position: relative;
}

/* Background Grid */
.bg-grid {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: linear-gradient(rgba(99, 102, 241, 0.03) 1px, transparent 1px),
                      linear-gradient(90deg, rgba(99, 102, 241, 0.03) 1px, transparent 1px);
    background-size: 50px 50px;
    pointer-events: none;
    z-index: -2;
    animation: gridMove 20s linear infinite;
}

@keyframes gridMove {
    0% { transform: translate(0, 0); }
    100% { transform: translate(50px, 50px); }
}

/* Background Orbs */
.bg-orbs {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: -1;
}

.orb {
    position: absolute;
    border-radius: 50%;
    opacity: 0.6;
    filter: blur(60px);
    animation: orbFloat 8s ease-in-out infinite;
}

.orb1 {
    width: 300px;
    height: 300px;
    background: radial-gradient(circle, var(--primary) 0%, transparent 70%);
    top: 20%;
    left: 10%;
    animation-delay: 0s;
}

.orb2 {
    width: 200px;
    height: 200px;
    background: radial-gradient(circle, var(--secondary) 0%, transparent 70%);
    top: 60%;
    right: 20%;
    animation-delay: 2s;
}

.orb3 {
    width: 250px;
    height: 250px;
    background: radial-gradient(circle, var(--accent) 0%, transparent 70%);
    bottom: 10%;
    left: 60%;
    animation-delay: 4s;
}

@keyframes orbFloat {
    0%, 100% { transform: translate(0, 0) scale(1); }
    25% { transform: translate(30px, -40px) scale(1.1); }
    50% { transform: translate(-20px, 30px) scale(0.9); }
    75% { transform: translate(40px, 20px) scale(1.05); }
}

/* Glassmorphism */
.glass {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    position: relative;
}

.glass::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
    border-radius: inherit;
    pointer-events: none;
}

/* Navigation */
nav {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 1000;
    padding: 10px 25px;
    background: transparent;
    transition: all 0.3s ease;
}

nav.glass {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--glass-border);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.nav-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    max-width: 1300px;
    margin: 0 auto;
}

.nav-logo {
    font-size: 1.5rem;
    font-weight: 700;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.nav-links {
    display: flex;
    list-style: none;
    gap: 35px;
}

.nav-links a {
    color: var(--text-primary);
    text-decoration: none;
    font-weight: 500;
    font-size: 0.95rem;
    transition: all 0.3s ease;
    padding: 10px 0;
    position: relative;
}

.nav-links a::before {
    content: "";
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 0;
    height: 2px;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
    transition: all 0.3s ease;
    transform: translateX(-50%);
}

.nav-links a:hover::before {
    width: 100%;
}

.nav-links a:hover {
    color: var(--primary);
}

/* Section Base */
section {
    padding: 100px 50px;
    max-width: 1400px;
    margin: 0 auto;
    position: relative;
}

.section-title {
    font-size: clamp(2.5rem, 5vw, 3.5rem);
    margin-bottom: 60px;
    text-align: center;
    background: linear-gradient(135deg, var(--text-primary), var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    position: relative;
    font-weight: 600;
}

.section-title::after {
    content: "";
    position: absolute;
    bottom: -20px;
    left: 50%;
    width: 80px;
    height: 3px;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
    transform: translateX(-50%);
    border-radius: 2px;
}

.section-subtitle {
    text-align: center;
    color: var(--text-secondary);
    font-size: 1.1rem;
    margin-top: 8px;
    margin-bottom: 40px;
    max-width: 700px;
    margin-left: auto;
    margin-right: auto;
    line-height: 1.6;
}

/* Dashboard Grid */
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
    margin-top: 40px;
}

/* Card Components */
.card {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 25px;
    transition: all 0.3s ease;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
}

.card:hover {
    transform: translateY(-8px);
    border-color: var(--primary);
    box-shadow: 0 20px 40px rgba(99, 102, 241, 0.3);
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--glass-border);
}

.card-title {
    font-size: 1.3rem;
    font-weight: 600;
    color: var(--text-primary);
}

.card-icon {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
}

.icon-stocks { background: rgba(99, 102, 241, 0.15); color: var(--primary); }
.icon-gold { background: rgba(245, 158, 11, 0.15); color: var(--warning); }
.icon-mutual { background: rgba(6, 182, 212, 0.15); color: var(--accent); }
.icon-bonds { background: rgba(16, 185, 129, 0.15); color: var(--success); }

.card-value {
    font-size: 2rem;
    font-weight: 700;
    margin: 10px 0;
    color: var(--text-primary);
}

.card-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 30px;
}

.stat-item {
    text-align: center;
    padding: 20px;
    border-radius: 16px;
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid var(--glass-border);
}

.stat-value {
    font-size: 1.8rem;
    font-weight: 700;
    margin: 10px 0;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.stat-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

/* Input Form */
.input-form {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 30px;
    margin-top: 40px;
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.form-group {
    margin-bottom: 15px;
}

.form-label {
    display: block;
    margin-bottom: 8px;
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.form-control {
    width: 100%;
    padding: 12px 16px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    color: var(--text-primary);
    font-family: "Space Grotesk", sans-serif;
    font-size: 1rem;
    transition: all 0.3s ease;
}

.form-control:focus {
    outline: none;
    border-color: var(--primary);
    background: rgba(255, 255, 255, 0.08);
}

.form-select {
    width: 100%;
    padding: 12px 16px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    color: var(--text-primary);
    font-family: "Space Grotesk", sans-serif;
    font-size: 1rem;
    appearance: none;
    background-image: "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23a1a1aa' d='M6 9L1 4h10z'/%3E%3C/svg%3E\")";
    background-repeat: no-repeat;
    background-position: right 12px center;
}

.form-select:focus {
    outline: none;
    border-color: var(--primary);
    background-color: rgba(255, 255, 255, 0.08);
}

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 12px;
    font-family: "Space Grotesk", sans-serif;
    font-weight: 600;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4);
}

.btn-outline {
    background: transparent;
    border: 2px solid var(--primary);
    color: var(--primary);
}

.btn-outline:hover {
    background: rgba(99, 102, 241, 0.1);
}

/* Chart Container */
.chart-container {
    margin-top: 30px;
    height: 350px;
}

/* Portfolio Breakdown */
.portfolio-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 30px;
    margin-top: 40px;
}

.asset-item {
    display: flex;
    align-items: center;
    padding: 15px;
    margin-bottom: 10px;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid var(--glass-border);
    transition: all 0.3s ease;
}

.asset-item:hover {
    background: rgba(255, 255, 255, 0.05);
    transform: translateX(5px);
}

.asset-color {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    margin-right: 15px;
}

.asset-info {
    flex: 1;
}

.asset-name {
    font-weight: 600;
    margin-bottom: 4px;
}

.asset-amount {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.asset-percentage {
    font-weight: 600;
    font-size: 0.9rem;
}

/* Insights */
.insights-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 25px;
    margin-top: 40px;
}

.insight-card {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 25px;
    transition: all 0.3s ease;
}

.insight-card:hover {
    transform: translateY(-5px);
    border-color: var(--accent);
}

.insight-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
}

.insight-icon {
    width: 35px;
    height: 35px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
}

.insight-title {
    font-size: 1.1rem;
    font-weight: 600;
}

.insight-good {
    background: rgba(16, 185, 129, 0.15);
    color: var(--success);
}

.insight-warning {
    background: rgba(245, 158, 11, 0.15);
    color: var(--warning);
}

.insight-danger {
    background: rgba(239, 68, 68, 0.15);
    color: var(--danger);
}

.insight-text {
    color: var(--text-secondary);
    line-height: 1.6;
    font-size: 0.95rem;
}

/* Real-time Badge */
.badge-realtime {
    display: inline-block;
    padding: 4px 10px;
    background: rgba(16, 185, 129, 0.15);
    color: var(--success);
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    margin-left: 10px;
}

/* Responsive */
@media (max-width: 768px) {
    section {
        padding: 60px 25px;
    }
    
    .portfolio-grid {
        grid-template-columns: 1fr;
    }
    
    .nav-links {
        display: none;
    }
    
    .form-grid {
        grid-template-columns: 1fr;
    }
    
    .chart-container {
        height: 250px;
    }
}

/* Animations */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.animate {
    animation: fadeInUp 0.8s ease forwards;
}

/* Loading Animation */
@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.loading {
    animation: pulse 1.5s ease-in-out infinite;
}

/* Tambahkan CSS ini untuk responsive layout */
@media (max-width: 768px) {
    #portfolioBreakdownGrid {
        grid-template-columns: 1fr !important;
    }
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.news-card {
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    padding: 25px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.news-card:hover {
    transform: translateY(-5px);
    border-color: var(--primary);
    box-shadow: 0 10px 30px rgba(99, 102, 241, 0.2);
}

.news-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: linear-gradient(180deg, var(--primary), var(--secondary));
}

.news-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 15px;
}

.news-source {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(99, 102, 241, 0.1);
    color: var(--primary);
    padding: 6px 12px;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 600;
}

.news-time {
    font-size: 0.75rem;
    color: var(--text-secondary);
    margin-top: 4px;
}

.news-title {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 12px;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.news-description {
    font-size: 0.95rem;
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: 15px;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.news-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 15px;
    border-top: 1px solid var(--glass-border);
}

.news-tags {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
}

.news-tag {
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-secondary);
    padding: 4px 10px;
    border-radius: 8px;
    font-size: 0.75rem;
}

.news-read-more {
    color: var(--primary);
    text-decoration: none;
    font-weight: 600;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 4px;
    transition: all 0.3s ease;
}

.news-read-more:hover {
    color: var(--secondary);
    gap: 8px;
}

.news-category-indonesia {
    background: rgba(255, 215, 0, 0.1);
    color: #FFD700;
}

.news-category-global {
    background: rgba(99, 102, 241, 0.1);
    color: var(--primary);
}

.news-breaking {
    position: absolute;
    top: 10px;
    right: 10px;
    background: var(--danger);
    color: white;
    padding: 4px 10px;
    border-radius: 8px;
    font-size: 0.7rem;
    font-weight: 700;
    z-index: 1;
}

/* Active button state */
.btn.active {
    background: linear-gradient(135deg, var(--primary), var(--secondary)) !important;
    color: white !important;
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4) !important;
}
</style>
</head>
<body>
<!-- Background -->
<div class="bg-grid"></div>
<div class="bg-orbs">
    <div class="orb orb1"></div>
    <div class="orb orb2"></div>
    <div class="orb orb3"></div>
</div>

<!-- Navigation -->
<nav id="siteNav">
    <div class="nav-container">
        <div class="nav-logo">üí∞ Portfolio Manager</div>
        <ul class="nav-links">
            <li><a href="#dashboard">Dashboard</a></li>
            <li><a href="#input">Input Aset</a></li>
            <li><a href="#portfolio">Portfolio</a></li>
            <li><a href="#gold">Harga Emas</a></li>
            <li><a href="#insights">Insights</a></li>
        </ul>
    </div>
</nav>

<!-- Hero Section -->
<section id="hero" style="min-height: 60vh; display: flex; align-items: center; justify-content: center; text-align: center;">
    <div class="glass" style="padding: 40px; max-width: 700px; text-align: center;">
        <h1 style="font-size: clamp(2.5rem, 6vw, 3.5rem); font-weight: 700; margin-bottom: 20px; background: linear-gradient(135deg, var(--text-primary), var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            Financial Portfolio Manager
        </h1>
        <p style="color: var(--text-secondary); font-size: 1.1rem; line-height: 1.6; margin-bottom: 30px;">
            Kelola dan pantau aset investasi Anda dengan mudah. Dapatkan insight real-time untuk membuat keputusan finansial yang lebih baik.
        </p>
        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
            <a href="#input" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> Tambah Aset
            </a>
            <a href="#dashboard" class="btn btn-outline">
                <i class="bi bi-graph-up"></i> Lihat Dashboard
            </a>
        </div>
    </div>
</section>

<!-- Dashboard Section -->
<section id="dashboard" class="animate">
    <h2 class="section-title">üìä Dashboard Overview</h2>
    <p class="section-subtitle">Ringkasan portofolio investasi Anda saat ini</p>
    
    <div class="stats-grid">
        <div class="stat-item">
            <div class="stat-label">Total Portfolio</div>
            <div class="stat-value" id="totalPortfolio">Rp 0</div>
            <div class="stat-label" style="color: var(--success);">+0.00%</div>
        </div>
        <div class="stat-item">
            <div class="stat-label">Jumlah Aset</div>
            <div class="stat-value" id="assetCount">0</div>
            <div class="stat-label">Berbagai Instrumen</div>
        </div>
        <div class="stat-item">
            <div class="stat-label">Profit/Loss</div>
            <div class="stat-value" id="profitLoss">Rp 0</div>
            <div class="stat-label" style="color: var(--success);">+0.00%</div>
        </div>
        <div class="stat-item">
            <div class="stat-label">Risk Level</div>
            <div class="stat-value" id="riskLevel">-</div>
            <div class="stat-label">Diversifikasi</div>
        </div>
    </div>
    
    <div class="dashboard-grid">
        <div class="card">
            <div class="card-header">
                <div class="card-title">üìà Saham IHSG</div>
                <div class="card-icon icon-stocks">
                    <i class="bi bi-graph-up"></i>
                </div>
            </div>
            <div class="card-value" id="ihsgValue">Rp 0</div>
            <div class="card-label">Total Investasi Saham</div>
            <div class="chart-container">
                <div id="ihsgChart"></div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <div class="card-title">ü•á Emas</div>
                <div class="card-icon icon-gold">
                    <i class="bi bi-circle-fill"></i>
                </div>
            </div>
            <div class="card-value" id="goldValue">Rp 0</div>
            <div class="card-label">Harga Emas <span class="badge-realtime">Real-time</span></div>
            <div class="chart-container">
                <div id="goldChart"></div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <div class="card-title">üìä Reksadana</div>
                <div class="card-icon icon-mutual">
                    <i class="bi bi-file-earmark-bar-graph"></i>
                </div>
            </div>
            <div class="card-value" id="mutualValue">Rp 0</div>
            <div class="card-label">Total Investasi Reksadana</div>
            <div class="chart-container">
                <div id="mutualChart"></div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <div class="card-title">üèõÔ∏è Obligasi</div>
                <div class="card-icon icon-bonds">
                    <i class="bi bi-building"></i>
                </div>
            </div>
            <div class="card-value" id="bondValue">Rp 0</div>
            <div class="card-label">Total Investasi Obligasi</div>
            <div class="chart-container">
                <div id="bondChart"></div>
            </div>
        </div>
    </div>
</section>

<!-- Input Section -->
<section id="input" class="animate">
    <h2 class="section-title">‚ûï Input Aset</h2>
    <p class="section-subtitle">Masukkan nominal investasi Anda untuk setiap instrumen</p>
    
    <div class="input-form">
        <div class="form-grid">
            <div class="form-group">
                <label class="form-label">Saham IHSG</label>
                <input type="number" id="ihsgInput" class="form-control" placeholder="Masukkan nominal (Rp)" min="0">
            </div>
            
            <div class="form-group">
                <label class="form-label">Emas (Gram)</label>
                <input type="number" id="goldInput" class="form-control" placeholder="Masukkan berat (gram)" min="0" step="0.01">
            </div>
            
            <div class="form-group">
                <label class="form-label">Reksadana</label>
                <input type="number" id="mutualInput" class="form-control" placeholder="Masukkan nominal (Rp)" min="0">
            </div>
            
            <div class="form-group">
                <label class="form-label">Obligasi</label>
                <input type="number" id="bondInput" class="form-control" placeholder="Masukkan nominal (Rp)" min="0">
            </div>
            
            <div class="form-group">
                <label class="form-label">Deposito</label>
                <input type="number" id="depositInput" class="form-control" placeholder="Masukkan nominal (Rp)" min="0">
            </div>
            
            <div class="form-group">
                <label class="form-label">Properti</label>
                <input type="number" id="propertyInput" class="form-control" placeholder="Masukkan nominal (Rp)" min="0">
            </div>
            
            <div class="form-group">
                <label class="form-label">Cryptocurrency</label>
                <input type="number" id="cryptoInput" class="form-control" placeholder="Masukkan nominal (Rp)" min="0">
            </div>
            
            <div class="form-group">
                <label class="form-label">Lainnya</label>
                <input type="number" id="otherInput" class="form-control" placeholder="Masukkan nominal (Rp)" min="0">
            </div>
        </div>
        
        <div style="margin-top: 30px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
            <button id="calculateBtn" class="btn btn-primary">
                <i class="bi bi-calculator"></i> Hitung Portfolio
            </button>
            <button id="resetBtn" class="btn btn-outline">
                <i class="bi bi-arrow-counterclockwise"></i> Reset
            </button>
        </div>
    </div>
</section>

<div class="portfolio-breakdown">
    <h3 style="
        text-align: center; 
        margin-bottom: 25px; 
        font-size: 1.4rem; 
        color: var(--text-primary);
        font-weight: 600;
    ">üìä Total Portfolio Breakdown</h3>
    
    <!-- Tambahkan wrapper dengan padding untuk memberikan space -->
    <div style="
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        border-radius: 20px;
        padding: 30px;
        margin-top: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    ">
        <div id="portfolioBreakdownGrid" style="
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 25px 30px; 
            margin: 0 auto;
        ">
            <!-- Cards akan di-generate otomatis oleh JavaScript -->
        </div>
    </div>
    
    <!-- Summary Stats -->
    <div style="
        display: grid; 
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
        gap: 15px; 
        margin-top: 30px; 
        background: rgba(255, 255, 255, 0.03); 
        padding: 20px; 
        border-radius: 16px; 
        border: 1px solid var(--glass-border);
    ">
        <div style="text-align: center;">
            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px;">Total Aset</div>
            <div id="summaryAssetCount" style="font-size: 1.8rem; font-weight: 700; color: var(--primary);">0</div>
        </div>
        <div style="text-align: center;">
            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px;">Nilai Portfolio</div>
            <div id="summaryTotalValue" style="font-size: 1.8rem; font-weight: 700; color: var(--accent);">Rp 0</div>
        </div>
        <div style="text-align: center;">
            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px;">Aset Terbesar</div>
            <div id="summaryLargestAsset" style="font-size: 1.8rem; font-weight: 700; color: var(--success);">-</div>
        </div>
        <div style="text-align: center;">
            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px;">Diversifikasi</div>
            <div id="summaryDiversification" style="font-size: 1.8rem; font-weight: 700; color: var(--warning);">-</div>
        </div>
    </div>
</div>

<!-- Real-time Gold Price -->
<section id="gold" class="animate">
    <h2 class="section-title">ü•á Harga Emas Real-time</h2>
    <p class="section-subtitle">Pantau pergerakan harga emas secara langsung</p>
    
    <div class="glass" style="padding: 30px; border-radius: 20px; margin-top: 30px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div>
                <h3 style="font-size: 1.3rem; margin-bottom: 5px;">Harga Emas Hari Ini</h3>
                <p style="color: var(--text-secondary);">Per gram - Update otomatis setiap 30 detik</p>
            </div>
            <div class="badge-realtime">Live</div>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
            <div style="text-align: center; padding: 20px; background: rgba(245, 158, 11, 0.05); border-radius: 16px;">
                <div style="color: var(--warning); font-size: 0.9rem; margin-bottom: 8px;">Harga Beli</div>
                <div id="goldBuyPrice" style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary);">Loading...</div>
            </div>
            <div style="text-align: center; padding: 20px; background: rgba(245, 158, 11, 0.05); border-radius: 16px;">
                <div style="color: var(--warning); font-size: 0.9rem; margin-bottom: 8px;">Harga Jual</div>
                <div id="goldSellPrice" style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary);">Loading...</div>
            </div>
            <div style="text-align: center; padding: 20px; background: rgba(245, 158, 11, 0.05); border-radius: 16px;">
                <div style="color: var(--warning); font-size: 0.9rem; margin-bottom: 8px;">Perubahan</div>
                <div id="goldChange" style="font-size: 1.5rem; font-weight: 700; color: var(--success);">Loading...</div>
            </div>
        </div>
        
        <div style="height: 400px;">
            <div id="goldLiveChart"></div>
        </div>
        
        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--glass-border); text-align: center;">
            <p style="color: var(--text-secondary); font-size: 0.9rem;">
                Data harga emas diambil dari sumber terpercaya dan diperbarui secara real-time
            </p>
        </div>
    </div>
</section>

<!-- Real-time IHSG -->
<section id="ihsg-live" class="animate">
    <h2 class="section-title">üìà IHSG Real-time</h2>
    <p class="section-subtitle">Pantau pergerakan Indeks Harga Saham Gabungan secara langsung</p>
    
    <div class="glass" style="padding: 30px; border-radius: 20px; margin-top: 30px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div>
                <h3 style="font-size: 1.3rem; margin-bottom: 5px;">IHSG Hari Ini</h3>
                <p style="color: var(--text-secondary);">Update otomatis setiap 30 detik</p>
            </div>
            <div class="badge-realtime">Live</div>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
            <div style="text-align: center; padding: 20px; background: rgba(99, 102, 241, 0.05); border-radius: 16px;">
                <div style="color: var(--primary); font-size: 0.9rem; margin-bottom: 8px;">Nilai IHSG</div>
                <div id="ihsgCurrentValue" style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary);">Loading...</div>
            </div>
            <div style="text-align: center; padding: 20px; background: rgba(99, 102, 241, 0.05); border-radius: 16px;">
                <div style="color: var(--primary); font-size: 0.9rem; margin-bottom: 8px;">Perubahan</div>
                <div id="ihsgChange" style="font-size: 1.5rem; font-weight: 700; color: var(--success);">Loading...</div>
            </div>
            <div style="text-align: center; padding: 20px; background: rgba(99, 102, 241, 0.05); border-radius: 16px;">
                <div style="color: var(--primary); font-size: 0.9rem; margin-bottom: 8px;">Volume</div>
                <div id="ihsgVolume" style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary);">Loading...</div>
            </div>
        </div>
        
        <div style="height: 400px;">
            <div id="ihsgLiveChart"></div>
        </div>
        
        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--glass-border); text-align: center;">
            <p style="color: var(--text-secondary); font-size: 0.9rem;">
                Data IHSG diambil dari Bursa Efek Indonesia (BEI) ‚Ä¢ Update otomatis setiap 30 detik
            </p>
        </div>
    </div>
</section>

<!-- Real-time S&P 500 -->
<section id="sp500-live" class="animate">
    <h2 class="section-title">üá∫üá∏ S&P 500 Real-time</h2>
    <p class="section-subtitle">Pantau pergerakan indeks saham global Amerika Serikat secara langsung</p>
    
    <div class="glass" style="padding: 30px; border-radius: 20px; margin-top: 30px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div>
                <h3 style="font-size: 1.3rem; margin-bottom: 5px;">S&P 500 Hari Ini</h3>
                <p style="color: var(--text-secondary);">Standard & Poor's 500 Index ‚Ä¢ Update otomatis setiap 30 detik</p>
            </div>
            <div class="badge-realtime">Live</div>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
            <div style="text-align: center; padding: 20px; background: rgba(239, 68, 68, 0.05); border-radius: 16px;">
                <div style="color: var(--danger); font-size: 0.9rem; margin-bottom: 8px;">Nilai S&P 500</div>
                <div id="sp500CurrentValue" style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary);">Loading...</div>
            </div>
            <div style="text-align: center; padding: 20px; background: rgba(239, 68, 68, 0.05); border-radius: 16px;">
                <div style="color: var(--danger); font-size: 0.9rem; margin-bottom: 8px;">Perubahan</div>
                <div id="sp500Change" style="font-size: 1.5rem; font-weight: 700; color: var(--success);">Loading...</div>
            </div>
            <div style="text-align: center; padding: 20px; background: rgba(239, 68, 68, 0.05); border-radius: 16px;">
                <div style="color: var(--danger); font-size: 0.9rem; margin-bottom: 8px;">52-Week Range</div>
                <div id="sp500Range" style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary);">Loading...</div>
            </div>
        </div>
        
        <div style="height: 400px;">
            <div id="sp500LiveChart"></div>
        </div>
        
        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--glass-border); text-align: center;">
            <p style="color: var(--text-secondary); font-size: 0.9rem;">
                Data S&P 500 diambil dari NYSE/NASDAQ ‚Ä¢ Update otomatis setiap 30 detik
            </p>
        </div>
    </div>
</section>

<!-- Insights Section -->
<section id="insights" class="animate">
    <h2 class="section-title">üí° Financial Insights</h2>
    <p class="section-subtitle">Rekomendasi dan analisis berdasarkan portofolio Anda</p>
    
    <div class="insights-grid">
        <div class="insight-card">
            <div class="insight-header">
                <div class="insight-icon insight-good">
                    <i class="bi bi-check-circle"></i>
                </div>
                <div class="insight-title">Diversifikasi Portofolio</div>
            </div>
            <p class="insight-text" id="diversificationInsight">
                Portofolio Anda memiliki diversifikasi yang baik dengan berbagai instrumen investasi.
            </p>
        </div>
        
        <div class="insight-card">
            <div class="insight-header">
                <div class="insight-icon insight-warning">
                    <i class="bi bi-exclamation-triangle"></i>
                </div>
                <div class="insight-title">Risk Assessment</div>
            </div>
            <p class="insight-text" id="riskInsight">
                Portofolio Anda memiliki tingkat risiko yang seimbang. Pertimbangkan untuk menambah alokasi obligasi.
            </p>
        </div>
        
        <div class="insight-card">
            <div class="insight-header">
                <div class="insight-icon insight-good">
                    <i class="bi bi-lightbulb"></i>
                </div>
                <div class="insight-title">Rekomendasi Investasi</div>
            </div>
            <p class="insight-text" id="recommendationInsight">
                Pertimbangkan untuk menambah alokasi reksadana saham untuk potensi return yang lebih tinggi.
            </p>
        </div>
    </div>
</section>

<!-- Latest Economic News -->
<section id="news" class="animate">
    <h2 class="section-title">üì∞ Latest Economic News</h2>
    <p class="section-subtitle">Berita terkini ekonomi & investasi Indonesia dan global</p>
    
    <div style="display: flex; gap: 20px; margin-bottom: 30px; flex-wrap: wrap;">
        <button id="newsIndonesiaBtn" class="btn btn-primary" style="flex: 1; min-width: 150px;">
            <i class="bi bi-flag"></i> Indonesia
        </button>
        <button id="newsWorldwideBtn" class="btn btn-outline" style="flex: 1; min-width: 150px;">
            <i class="bi bi-globe"></i> Global
        </button>
        <button id="newsAllBtn" class="btn btn-outline" style="flex: 1; min-width: 150px;">
            <i class="bi bi-newspaper"></i> Semua Berita
        </button>
        <div style="display: flex; align-items: center; gap: 10px; margin-left: auto;">
            <i class="bi bi-arrow-clockwise" id="refreshNewsBtn" style="cursor: pointer; font-size: 1.2rem; color: var(--primary);"></i>
            <span id="lastUpdatedTime" style="font-size: 0.85rem; color: var(--text-secondary);">Last updated: -</span>
        </div>
    </div>
    
    <div id="newsLoading" style="text-align: center; padding: 40px; display: none;">
        <div style="width: 50px; height: 50px; border: 4px solid var(--glass-border); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
        <p style="color: var(--text-secondary);">Loading berita terbaru...</p>
    </div>
    
    <div id="newsError" style="display: none; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 16px; padding: 20px; text-align: center; margin-bottom: 20px;">
        <i class="bi bi-exclamation-triangle" style="font-size: 2rem; color: var(--danger); margin-bottom: 10px;"></i>
        <p style="color: var(--danger); margin-bottom: 10px;">Gagal memuat berita</p>
        <button id="retryNewsBtn" class="btn btn-outline" style="border-color: var(--danger); color: var(--danger);">
            <i class="bi bi-arrow-clockwise"></i> Coba Lagi
        </button>
    </div>
    
    <div id="newsContainer" class="dashboard-grid">
        <!-- News cards akan di-generate otomatis oleh JavaScript -->
    </div>
    
    <div style="text-align: center; margin-top: 30px; padding: 20px; background: rgba(255, 255, 255, 0.03); border-radius: 16px; border: 1px solid var(--glass-border);">
        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 10px;">
            <i class="bi bi-info-circle"></i> Berita diupdate otomatis setiap 5 menit
        </p>
        <p style="color: var(--text-secondary); font-size: 0.85rem;">
            Sumber: NewsAPI.org, Kontan, Bisnis Indonesia, Bloomberg, Reuters, CNBC
        </p>
    </div>
</section>

<!-- Footer -->
<footer style="margin-top: 100px; padding: 40px; text-align: center; background: rgba(255, 255, 255, 0.02); border-top: 1px solid var(--glass-border);">
    <p style="color: var(--text-secondary); font-size: 0.9rem;">
        ¬© <span id="year"></span> Portfolio Manager - Financial Dashboard
    </p>
    <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 10px;">
        Data harga emas real-time ‚Ä¢ Update otomatis setiap 30 detik
    </p>
</footer>

<script>
// Initialize year
document.getElementById('year').textContent = new Date().getFullYear();

// Portfolio Data (Input from IDE)
const portfolioData = {
    ihsg: 50000000,        // Saham IHSG: Rp 50,000,000
    gold: 100,             // Emas: 100 gram
    mutual: 30000000,      // Reksadana: Rp 30,000,000
    bonds: 20000000,       // Obligasi: Rp 20,000,000
    deposit: 15000000,     // Deposito: Rp 15,000,000
    property: 100000000,   // Properti: Rp 100,000,000
    crypto: 5000000,       // Cryptocurrency: Rp 5,000,000
    other: 10000000        // Lainnya: Rp 10,000,000
};

// Current gold price (will be updated in real-time)
let currentGoldPrice = {
    buy: 1250000,  // Rp per gram
    sell: 1230000, // Rp per gram
    change: 0.5    // percentage change
};

// Real-time gold price simulation
function simulateGoldPrice() {
    // Simulate price changes
    const fluctuation = (Math.random() - 0.5) * 20000; // ¬± Rp 10,000
    currentGoldPrice.buy += fluctuation;
    currentGoldPrice.sell += fluctuation;
    
    // Ensure prices don't go negative
    currentGoldPrice.buy = Math.max(1000000, currentGoldPrice.buy);
    currentGoldPrice.sell = Math.max(980000, currentGoldPrice.sell);
    
    // Calculate percentage change
    currentGoldPrice.change = ((currentGoldPrice.buy - 1250000) / 1250000) * 100;
    
    // Update display
    document.getElementById('goldBuyPrice').textContent = formatCurrency(currentGoldPrice.buy);
    document.getElementById('goldSellPrice').textContent = formatCurrency(currentGoldPrice.sell);
    
    const changeElement = document.getElementById('goldChange');
    changeElement.textContent = currentGoldPrice.change.toFixed(2) + '%';
    changeElement.style.color = currentGoldPrice.change >= 0 ? 'var(--success)' : 'var(--danger)';
}

// Current IHSG data (will be updated in real-time)
let currentIHSG = {
    value: 7200.50,        // Starting value
    previousClose: 7180.25, // Previous closing value
    change: 0.28,          // percentage change
    volume: 12500000000    // Trading volume
};

// Real-time IHSG price simulation
function simulateIHSGPrice() {
    // Simulate price changes (more volatile than gold)
    const fluctuation = (Math.random() - 0.5) * 80; // ¬± 40 points
    currentIHSG.value += fluctuation;
    
    // Ensure IHSG doesn't go too low
    currentIHSG.value = Math.max(6000, currentIHSG.value);
    
    // Calculate percentage change
    currentIHSG.change = ((currentIHSG.value - currentIHSG.previousClose) / currentIHSG.previousClose) * 100;
    
    // Simulate volume changes
    currentIHSG.volume = Math.round(10000000000 + Math.random() * 5000000000);
    
    // Update display
    document.getElementById('ihsgCurrentValue').textContent = currentIHSG.value.toFixed(2);
    
    const changeElement = document.getElementById('ihsgChange');
    changeElement.textContent = currentIHSG.change.toFixed(2) + '%';
    changeElement.style.color = currentIHSG.change >= 0 ? 'var(--success)' : 'var(--danger)';
    
    // Format volume (in billion)
    const volumeBillion = (currentIHSG.volume / 1000000000).toFixed(1);
    document.getElementById('ihsgVolume').textContent = volumeBillion + 'B';
}

// Initialize IHSG chart
function initIHSGLiveChart() {
    const ihsgLiveChart = new ApexCharts(document.querySelector("#ihsgLiveChart"), {
        chart: { 
            type: 'line', 
            height: 300, 
            animations: { 
                enabled: true, 
                dynamicAnimation: { speed: 300 } 
            },
            toolbar: { show: false }
        },
        series: [{ 
            name: 'IHSG', 
            data: [] 
        }],
        xaxis: { 
            type: 'datetime',
            labels: { datetimeFormatter: { hour: 'HH:mm' } }
        },
        yaxis: { 
            decimalsInFloat: 2, 
            labels: { 
                formatter: val => Math.round(val).toLocaleString() 
            },
            title: { text: 'Poin', style: { color: 'var(--text-secondary)' } }
        },
        colors: ['#6366f1'],
        stroke: { 
            curve: 'smooth', 
            width: 3,
            lineCap: 'round'
        },
        markers: { size: 0 },
        tooltip: { 
            x: { format: 'HH:mm:ss' }, 
            y: { 
                formatter: val => val.toFixed(2) + ' poin',
                title: { formatter: () => 'IHSG: ' }
            }
        },
        grid: {
            borderColor: 'rgba(255, 255, 255, 0.08)',
            strokeDashArray: 4
        },
        dataLabels: { enabled: false }
    });
    ihsgLiveChart.render();
    
    // Store chart reference for updates
    window.ihsgLiveChart = ihsgLiveChart;
}

// Update real-time IHSG chart
function updateIHSGLiveChart() {
    const now = new Date().getTime();
    const value = currentIHSG.value;
    
    const series = window.ihsgLiveChart.w.config.series[0].data;
    series.push({ x: now, y: value });
    
    // Keep only last 50 data points
    if (series.length > 50) {
        series.shift();
    }
    
    window.ihsgLiveChart.updateSeries([{
        name: 'IHSG',
        data: series
    }]);
}

// Add to DOMContentLoaded event
document.addEventListener('DOMContentLoaded', function() {
    // ... existing code ...
    
    // Initialize IHSG chart
    initIHSGLiveChart();
    
    // Initial IHSG update
    simulateIHSGPrice();
    
    // Update IHSG every 30 seconds
    setInterval(simulateIHSGPrice, 30000);
    
    // Update IHSG chart every 2 seconds
    setInterval(updateIHSGLiveChart, 2000);
});

// Current S&P 500 data (will be updated in real-time)
let currentSP500 = {
    value: 5200.50,        // Starting value
    previousClose: 5185.25, // Previous closing value
    change: 0.29,          // percentage change
    high52Week: 5300.00,   // 52-week high
    low52Week: 4100.00     // 52-week low
};

// Real-time S&P 500 price simulation
function simulateSP500Price() {
    // Simulate price changes (US market hours: 9:30 AM - 4:00 PM ET)
    const fluctuation = (Math.random() - 0.5) * 40; // ¬± 20 points
    currentSP500.value += fluctuation;
    
    // Ensure S&P 500 doesn't go too low
    currentSP500.value = Math.max(4000, currentSP500.value);
    
    // Calculate percentage change
    currentSP500.change = ((currentSP500.value - currentSP500.previousClose) / currentSP500.previousClose) * 100;
    
    // Update display
    document.getElementById('sp500CurrentValue').textContent = currentSP500.value.toFixed(2);
    
    const changeElement = document.getElementById('sp500Change');
    changeElement.textContent = currentSP500.change.toFixed(2) + '%';
    changeElement.style.color = currentSP500.change >= 0 ? 'var(--success)' : 'var(--danger)';
    
    // 52-week range display
    const rangeText = `${Math.round(currentSP500.low52Week).toLocaleString()}-${Math.round(currentSP500.high52Week).toLocaleString()}`;
    document.getElementById('sp500Range').textContent = rangeText;
}

// Initialize S&P 500 chart
function initSP500LiveChart() {
    const sp500LiveChart = new ApexCharts(document.querySelector("#sp500LiveChart"), {
        chart: { 
            type: 'line', 
            height: 300, 
            animations: { 
                enabled: true, 
                dynamicAnimation: { speed: 300 } 
            },
            toolbar: { show: false }
        },
        series: [{ 
            name: 'S&P 500', 
            data: [] 
        }],
        xaxis: { 
            type: 'datetime',
            labels: { datetimeFormatter: { hour: 'HH:mm' } }
        },
        yaxis: { 
            decimalsInFloat: 2, 
            labels: { 
                formatter: val => Math.round(val).toLocaleString() 
            },
            title: { text: 'Poin', style: { color: 'var(--text-secondary)' } }
        },
        colors: ['#ef4444'],
        stroke: { 
            curve: 'smooth', 
            width: 3,
            lineCap: 'round'
        },
        markers: { size: 0 },
        tooltip: { 
            x: { format: 'HH:mm:ss' }, 
            y: { 
                formatter: val => val.toFixed(2) + ' poin',
                title: { formatter: () => 'S&P 500: ' }
            }
        },
        grid: {
            borderColor: 'rgba(255, 255, 255, 0.08)',
            strokeDashArray: 4
        },
        dataLabels: { enabled: false }
    });
    sp500LiveChart.render();
    
    // Store chart reference for updates
    window.sp500LiveChart = sp500LiveChart;
}

// Update real-time S&P 500 chart
function updateSP500LiveChart() {
    const now = new Date().getTime();
    const value = currentSP500.value;
    
    const series = window.sp500LiveChart.w.config.series[0].data;
    series.push({ x: now, y: value });
    
    // Keep only last 50 data points
    if (series.length > 50) {
        series.shift();
    }
    
    window.sp500LiveChart.updateSeries([{
        name: 'S&P 500',
        data: series
    }]);
}

// Add to DOMContentLoaded event
document.addEventListener('DOMContentLoaded', function() {
    // ... existing code ...
    
    // Initialize S&P 500 chart
    initSP500LiveChart();
    
    // Initial S&P 500 update
    simulateSP500Price();
    
    // Update S&P 500 every 30 seconds
    setInterval(simulateSP500Price, 30000);
    
    // Update S&P 500 chart every 2 seconds
    setInterval(updateSP500LiveChart, 2000);
});

// Format currency
function formatCurrency(amount) {
    return 'Rp ' + amount.toLocaleString('id-ID');
}

// Calculate portfolio
function calculatePortfolio() {
    const ihsg = parseFloat(document.getElementById('ihsgInput').value) || portfolioData.ihsg;
    const goldGram = parseFloat(document.getElementById('goldInput').value) || portfolioData.gold;
    const mutual = parseFloat(document.getElementById('mutualInput').value) || portfolioData.mutual;
    const bonds = parseFloat(document.getElementById('bondInput').value) || portfolioData.bonds;
    const deposit = parseFloat(document.getElementById('depositInput').value) || portfolioData.deposit;
    const property = parseFloat(document.getElementById('propertyInput').value) || portfolioData.property;
    const crypto = parseFloat(document.getElementById('cryptoInput').value) || portfolioData.crypto;
    const other = parseFloat(document.getElementById('otherInput').value) || portfolioData.other;
    
    // Calculate values
    const goldValue = goldGram * currentGoldPrice.buy;
    const total = ihsg + goldValue + mutual + bonds + deposit + property + crypto + other;
    
    // Update dashboard
    document.getElementById('ihsgValue').textContent = formatCurrency(ihsg);
    document.getElementById('goldValue').textContent = formatCurrency(goldValue);
    document.getElementById('mutualValue').textContent = formatCurrency(mutual);
    document.getElementById('bondValue').textContent = formatCurrency(bonds);
    document.getElementById('totalPortfolio').textContent = formatCurrency(total);
    
    // Update asset count
    const assetCount = [ihsg, goldGram, mutual, bonds, deposit, property, crypto, other]
        .filter(val => val > 0).length;
    document.getElementById('assetCount').textContent = assetCount;
    
    // Update charts
    updateCharts(ihsg, goldValue, mutual, bonds, deposit, property, crypto, other, total);
    
    // Update insights
    updateInsights(ihsg, goldValue, mutual, bonds, total);
}

function updatePortfolioBreakdown(ihsg, gold, mutual, bonds, deposit, property, crypto, other, total) {
    const breakdownContainer = document.getElementById('portfolioBreakdownGrid');
    
    // Data aset dengan informasi lengkap
    const assets = [
        { 
            name: 'Saham IHSG', 
            value: ihsg, 
            color: '#6366f1', 
            icon: 'üìà', 
            optimalMin: 35, 
            optimalMax: 45,
            description: 'Investasi jangka panjang dengan potensi return tinggi'
        },
        { 
            name: 'Emas', 
            value: gold, 
            color: '#f59e0b', 
            icon: 'ü•á', 
            optimalMin: 5, 
            optimalMax: 10,
            description: 'Hedge terhadap inflasi dan volatilitas pasar'
        },
        { 
            name: 'Reksadana', 
            value: mutual, 
            color: '#06b6d4', 
            icon: 'üìä', 
            optimalMin: 20, 
            optimalMax: 30,
            description: 'Diversifikasi profesional dengan manajemen aktif'
        },
        { 
            name: 'Obligasi', 
            value: bonds, 
            color: '#10b981', 
            icon: 'üèõÔ∏è', 
            optimalMin: 15, 
            optimalMax: 25,
            description: 'Investasi stabil dengan pendapatan berkala'
        },
        { 
            name: 'Deposito', 
            value: deposit, 
            color: '#8b5cf6', 
            icon: 'üè¶', 
            optimalMin: 5, 
            optimalMax: 10,
            description: 'Likuiditas tinggi dengan risiko minimal'
        },
        { 
            name: 'Properti', 
            value: property, 
            color: '#ec4899', 
            icon: 'üè†', 
            optimalMin: 10, 
            optimalMax: 20,
            description: 'Aset fisik dengan potensi apresiasi jangka panjang'
        },
        { 
            name: 'Cryptocurrency', 
            value: crypto, 
            color: '#ef4444', 
            icon: '‚Çø', 
            optimalMin: 0, 
            optimalMax: 5,
            description: 'High risk, high reward - alokasi terbatas'
        },
        { 
            name: 'Lainnya', 
            value: other, 
            color: '#3b82f6', 
            icon: 'üì¶', 
            optimalMin: 0, 
            optimalMax: 10,
            description: 'Aset diversifikasi lainnya'
        }
    ].filter(asset => asset.value > 0).sort((a, b) => b.value - a.value);
    
    // Generate cards dengan layout 2 kolom
    let html = '';
    
    assets.forEach((asset, index) => {
        const percentage = ((asset.value / total) * 100).toFixed(1);
        const percentageNum = parseFloat(percentage);
        const width = Math.min(100, Math.max(5, percentageNum));
        
        // Status alokasi
        let allocationStatus = '';
        let allocationColor = '';
        let allocationIcon = '';
        
        if (percentageNum > asset.optimalMax) {
            allocationStatus = 'Terlalu Tinggi';
            allocationColor = '#ef4444';
            allocationIcon = '‚ö†Ô∏è';
        } else if (percentageNum < asset.optimalMin) {
            allocationStatus = 'Terlalu Rendah';
            allocationColor = '#10b981';
            allocationIcon = '‚ÜóÔ∏è';
        } else {
            allocationStatus = 'Optimal';
            allocationColor = '#10b981';
            allocationIcon = '‚úì';
        }
        
        html += `
            <div class="asset-card" style="
                background: var(--glass-bg); 
                border: 1px solid var(--glass-border); 
                border-radius: 16px; 
                padding: 25px; 
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
                border-left: 4px solid ${asset.color};
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                cursor: default;
            ">
                <!-- Decorative background element -->
                <div style="
                    position: absolute; 
                    top: -50%; 
                    right: -30%; 
                    width: 100%; 
                    height: 200%; 
                    background: radial-gradient(circle, ${asset.color}08 0%, transparent 70%);
                    z-index: 0; 
                    transform: rotate(15deg);
                "></div>
                
                <div style="position: relative; z-index: 1;">
                    <!-- Header with Icon and Name -->
                    <div style="
                        display: flex; 
                        align-items: flex-start; 
                        gap: 15px; 
                        margin-bottom: 18px;
                    ">
                        <div style="
                            width: 52px; 
                            height: 52px; 
                            border-radius: 14px; 
                            background: linear-gradient(135deg, ${asset.color}, ${adjustColor(asset.color, 30)});
                            display: flex; 
                            align-items: center; 
                            justify-content: center;
                            font-size: 1.7rem;
                            box-shadow: 0 4px 12px ${asset.color}25;
                            flex-shrink: 0;
                        ">
                            ${asset.icon}
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="
                                font-weight: 700; 
                                font-size: 1.15rem; 
                                color: var(--text-primary); 
                                margin-bottom: 6px;
                                line-height: 1.3;
                            ">
                                ${asset.name}
                            </div>
                            <div style="
                                font-size: 0.85rem; 
                                color: var(--text-secondary);
                                line-height: 1.5;
                            ">
                                ${asset.description}
                            </div>
                        </div>
                        <div style="
                            background: ${asset.color}20; 
                            color: ${asset.color}; 
                            padding: 8px 14px; 
                            border-radius: 14px; 
                            font-weight: 700; 
                            font-size: 1rem;
                            min-width: 70px;
                            text-align: center;
                            flex-shrink: 0;
                            align-self: flex-start;
                        ">
                            ${percentage}%
                        </div>
                    </div>
                    
                    <!-- Value Display -->
                    <div style="
                        font-size: 1.6rem; 
                        font-weight: 700; 
                        color: var(--text-primary); 
                        margin-bottom: 18px;
                        line-height: 1.2;
                    ">
                        ${formatCurrency(asset.value)}
                    </div>
                    
                    <!-- Progress Bar with Labels -->
                    <div style="margin-bottom: 15px;">
                        <div style="
                            display: flex; 
                            justify-content: space-between; 
                            margin-bottom: 8px; 
                            font-size: 0.82rem; 
                            color: var(--text-secondary);
                            font-weight: 500;
                        ">
                            <span>Alokasi Portofolio</span>
                            <span>${percentage}%</span>
                        </div>
                        <div style="
                            background: rgba(255, 255, 255, 0.05); 
                            border-radius: 8px; 
                            height: 10px; 
                            overflow: hidden;
                            position: relative;
                        ">
                            <div style="
                                width: ${width}%; 
                                background: linear-gradient(90deg, ${asset.color}, ${adjustColor(asset.color, 20)}); 
                                height: 100%; 
                                border-radius: 8px; 
                                transition: width 0.8s cubic-bezier(0.23, 1, 0.32, 1);
                                position: relative;
                            ">
                                <!-- Progress indicator dot -->
                                <div style="
                                    position: absolute; 
                                    right: -6px; 
                                    top: 50%; 
                                    transform: translateY(-50%);
                                    width: 12px; 
                                    height: 12px; 
                                    background: ${asset.color}; 
                                    border-radius: 50%;
                                    border: 2px solid var(--bg-dark);
                                    display: ${width > 5 && width < 95 ? 'block' : 'none'};
                                    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
                                "></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Allocation Status -->
                    <div style="
                        display: flex; 
                        justify-content: space-between; 
                        align-items: center; 
                        padding: 10px 12px;
                        background: ${allocationColor}08;
                        border-radius: 10px;
                        border: 1px solid ${allocationColor}15;
                        margin-top: 5px;
                    ">
                        <div style="
                            display: flex; 
                            align-items: center; 
                            gap: 6px;
                            font-size: 0.85rem; 
                            color: ${allocationColor};
                            font-weight: 600;
                        ">
                            <span>${allocationIcon}</span>
                            <span>${allocationStatus}</span>
                        </div>
                        <div style="
                            font-size: 0.78rem; 
                            color: var(--text-secondary);
                            font-weight: 500;
                        ">
                            Rekomendasi: ${asset.optimalMin}-${asset.optimalMax}%
                        </div>
                    </div>
                    
                    <!-- Rank Info -->
                    <div style="
                        margin-top: 12px; 
                        padding-top: 12px; 
                        border-top: 1px dashed rgba(255, 255, 255, 0.1);
                        font-size: 0.8rem; 
                        color: var(--text-secondary);
                        display: flex; 
                        justify-content: space-between;
                        font-weight: 500;
                    ">
                        <span>peringkat #${index + 1} dari ${assets.length}</span>
                        <span>${Math.round(asset.value / total * 1000) / 10} / Rp 1.000</span>
                    </div>
                </div>
            </div>
        `;
    });
    
    breakdownContainer.innerHTML = html;
    
    // Update summary stats
    document.getElementById('summaryAssetCount').textContent = assets.length;
    document.getElementById('summaryTotalValue').textContent = formatCurrency(total);
    document.getElementById('summaryLargestAsset').textContent = assets[0]?.name || '-';
    
    // Diversification score
    const diversificationScore = Math.min(100, Math.round((assets.length / 8) * 100));
    const diversificationText = diversificationScore >= 80 ? 'Sangat Baik' : 
                               diversificationScore >= 60 ? 'Baik' : 
                               diversificationScore >= 40 ? 'Cukup' : 'Perlu Ditingkatkan';
    const diversificationColor = diversificationScore >= 80 ? '#10b981' : 
                                diversificationScore >= 60 ? '#f59e0b' : '#ef4444';
    document.getElementById('summaryDiversification').textContent = diversificationText;
    document.getElementById('summaryDiversification').style.color = diversificationColor;
}

// Helper function untuk adjust warna
function adjustColor(hex, percent) {
    const num = parseInt(hex.replace('#', ''), 16);
    const amt = Math.round(2.55 * percent);
    const R = (num >> 16) + amt;
    const G = (num >> 8 & 0x00FF) + amt;
    const B = (num & 0x0000FF) + amt;
    return '#' + (
        0x1000000 + 
        (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 + 
        (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 + 
        (B < 255 ? B < 1 ? 0 : B : 255)
    ).toString(16).slice(1);
}

// Helper function untuk adjust warna
function adjustColor(hex, percent) {
    const num = parseInt(hex.replace('#', ''), 16);
    const amt = Math.round(2.55 * percent);
    const R = (num >> 16) + amt;
    const G = (num >> 8 & 0x00FF) + amt;
    const B = (num & 0x0000FF) + amt;
    return '#' + (
        0x1000000 + 
        (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 + 
        (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 + 
        (B < 255 ? B < 1 ? 0 : B : 255)
    ).toString(16).slice(1);
}

// Helper function untuk adjust warna
function adjustColor(hex, percent) {
    const num = parseInt(hex.replace('#', ''), 16);
    const amt = Math.round(2.55 * percent);
    const R = (num >> 16) + amt;
    const G = (num >> 8 & 0x00FF) + amt;
    const B = (num & 0x0000FF) + amt;
    return '#' + (
        0x1000000 + 
        (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 + 
        (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 + 
        (B < 255 ? B < 1 ? 0 : B : 255)
    ).toString(16).slice(1);
}

// Update fungsi calculatePortfolio
function calculatePortfolio() {
    const ihsg = parseFloat(document.getElementById('ihsgInput').value) || portfolioData.ihsg;
    const goldGram = parseFloat(document.getElementById('goldInput').value) || portfolioData.gold;
    const mutual = parseFloat(document.getElementById('mutualInput').value) || portfolioData.mutual;
    const bonds = parseFloat(document.getElementById('bondInput').value) || portfolioData.bonds;
    const deposit = parseFloat(document.getElementById('depositInput').value) || portfolioData.deposit;
    const property = parseFloat(document.getElementById('propertyInput').value) || portfolioData.property;
    const crypto = parseFloat(document.getElementById('cryptoInput').value) || portfolioData.crypto;
    const other = parseFloat(document.getElementById('otherInput').value) || portfolioData.other;
    
    // Calculate values
    const goldValue = goldGram * currentGoldPrice.buy;
    const total = ihsg + goldValue + mutual + bonds + deposit + property + crypto + other;
    
    // Update dashboard
    document.getElementById('ihsgValue').textContent = formatCurrency(ihsg);
    document.getElementById('goldValue').textContent = formatCurrency(goldValue);
    document.getElementById('mutualValue').textContent = formatCurrency(mutual);
    document.getElementById('bondValue').textContent = formatCurrency(bonds);
    document.getElementById('totalPortfolio').textContent = formatCurrency(total);
    
    // Update asset count
    const assetCount = [ihsg, goldGram, mutual, bonds, deposit, property, crypto, other]
        .filter(val => val > 0).length;
    document.getElementById('assetCount').textContent = assetCount;
    
    // Update portfolio breakdown (REPLACE donut chart)
    updatePortfolioBreakdown(ihsg, goldValue, mutual, bonds, deposit, property, crypto, other, total);
    
    // Update insights
    updateInsights(ihsg, goldValue, mutual, bonds, total);
}

// Update insights
function updateInsights(ihsg, gold, mutual, bonds, total) {
    const equityPercentage = ((ihsg + mutual) / total) * 100;
    const debtPercentage = ((bonds + gold) / total) * 100;
    
    // Diversification insight
    if (equityPercentage > 70) {
        document.getElementById('diversificationInsight').textContent = 
            'Portofolio Anda condong ke saham. Pertimbangkan untuk menambah alokasi obligasi dan emas untuk diversifikasi.';
    } else if (equityPercentage < 30) {
        document.getElementById('diversificationInsight').textContent = 
            'Portofolio Anda terlalu konservatif. Pertimbangkan untuk menambah alokasi saham untuk potensi return lebih tinggi.';
    } else {
        document.getElementById('diversificationInsight').textContent = 
            'Portofolio Anda memiliki diversifikasi yang baik dengan keseimbangan antara saham dan obligasi.';
    }
    
    // Risk assessment
    if (equityPercentage > 60) {
        document.getElementById('riskInsight').textContent = 
            'Portofolio Anda memiliki tingkat risiko tinggi. Cocok untuk investor muda dengan horizon investasi panjang.';
        document.getElementById('riskLevel').textContent = 'Tinggi';
        document.querySelector('#riskLevel').style.color = 'var(--danger)';
    } else if (equityPercentage > 40) {
        document.getElementById('riskInsight').textContent = 
            'Portofolio Anda memiliki tingkat risiko moderat. Seimbang antara pertumbuhan dan stabilitas.';
        document.getElementById('riskLevel').textContent = 'Moderat';
        document.querySelector('#riskLevel').style.color = 'var(--warning)';
    } else {
        document.getElementById('riskInsight').textContent = 
            'Portofolio Anda memiliki tingkat risiko rendah. Lebih stabil namun potensi return lebih rendah.';
        document.getElementById('riskLevel').textContent = 'Rendah';
        document.querySelector('#riskLevel').style.color = 'var(--success)';
    }
    
    // Recommendation
    if (gold < total * 0.05) {
        document.getElementById('recommendationInsight').textContent = 
            'Alokasi emas Anda masih rendah. Pertimbangkan menambah 5-10% untuk hedge terhadap inflasi.';
    } else if (mutual < total * 0.2) {
        document.getElementById('recommendationInsight').textContent = 
            'Pertimbangkan untuk menambah alokasi reksadana untuk diversifikasi dan profesional management.';
    } else {
        document.getElementById('recommendationInsight').textContent = 
            'Portofolio Anda sudah seimbang. Lakukan rebalancing setiap 6-12 bulan untuk mempertahankan alokasi ideal.';
    }
}

// Initialize charts
function initCharts() {
    // IHSG Chart
    const ihsgChart = new ApexCharts(document.querySelector("#ihsgChart"), {
        chart: { type: 'area', height: 200, toolbar: { show: false } },
        series: [{ name: 'IHSG', data: [5000, 5100, 5050, 5200, 5150, 5300, 5250, 5400, 5350, 5500] }],
        xaxis: { categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'] },
        colors: ['#6366f1'],
        fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.7, opacityTo: 0.1 } },
        stroke: { curve: 'smooth', width: 2 },
        tooltip: { y: { formatter: val => formatCurrency(val * 10000) } }
    });
    ihsgChart.render();
    
    // Gold Chart
    const goldChart = new ApexCharts(document.querySelector("#goldChart"), {
        chart: { type: 'area', height: 200, toolbar: { show: false } },
        series: [{ name: 'Gold', data: [1200, 1220, 1210, 1230, 1240, 1250, 1260, 1270, 1280, 1290] }],
        xaxis: { categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'] },
        colors: ['#f59e0b'],
        fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.7, opacityTo: 0.1 } },
        stroke: { curve: 'smooth', width: 2 },
        tooltip: { y: { formatter: val => formatCurrency(val * 1000) } }
    });
    goldChart.render();
    
    // Mutual Fund Chart
    const mutualChart = new ApexCharts(document.querySelector("#mutualChart"), {
        chart: { type: 'area', height: 200, toolbar: { show: false } },
        series: [{ name: 'Reksadana', data: [100, 105, 103, 108, 110, 115, 112, 118, 120, 125] }],
        xaxis: { categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'] },
        colors: ['#06b6d4'],
        fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.7, opacityTo: 0.1 } },
        stroke: { curve: 'smooth', width: 2 },
        tooltip: { y: { formatter: val => formatCurrency(val * 100000) } }
    });
    mutualChart.render();
    
    // Bond Chart
    const bondChart = new ApexCharts(document.querySelector("#bondChart"), {
        chart: { type: 'area', height: 200, toolbar: { show: false } },
        series: [{ name: 'Obligasi', data: [95, 96, 97, 98, 99, 100, 101, 102, 103, 104] }],
        xaxis: { categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'] },
        colors: ['#10b981'],
        fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.7, opacityTo: 0.1 } },
        stroke: { curve: 'smooth', width: 2 },
        tooltip: { y: { formatter: val => formatCurrency(val * 100000) } }
    });
    bondChart.render();
    
    // Real-time Gold Chart
    const goldLiveChart = new ApexCharts(document.querySelector("#goldLiveChart"), {
        chart: { type: 'line', height: 300, animations: { enabled: true, dynamicAnimation: { speed: 300 } } },
        series: [{ name: 'Harga Emas', data: [] }],
        xaxis: { type: 'datetime' },
        yaxis: { decimalsInFloat: 0, labels: { formatter: val => 'Rp ' + Math.round(val).toLocaleString() } },
        colors: ['#f59e0b'],
        stroke: { curve: 'smooth', width: 3 },
        markers: { size: 0 },
        tooltip: { x: { format: 'HH:mm:ss' }, y: { formatter: val => formatCurrency(val) } }
    });
    goldLiveChart.render();
    
    // Store chart reference for updates
    window.goldLiveChart = goldLiveChart;
}

// Update real-time gold chart
function updateGoldChart() {
    const now = new Date().getTime();
    const price = currentGoldPrice.buy;
    
    const series = window.goldLiveChart.w.config.series[0].data;
    series.push({ x: now, y: price });
    
    // Keep only last 50 data points
    if (series.length > 50) {
        series.shift();
    }
    
    window.goldLiveChart.updateSeries([{
        name: 'Harga Emas',
        data: series
    }]);
}

// Event Listeners
document.addEventListener('DOMContentLoaded', function() {
    // Initialize charts
    initCharts();
    
    // Set initial input values
    document.getElementById('ihsgInput').value = portfolioData.ihsg;
    document.getElementById('goldInput').value = portfolioData.gold;
    document.getElementById('mutualInput').value = portfolioData.mutual;
    document.getElementById('bondInput').value = portfolioData.bonds;
    document.getElementById('depositInput').value = portfolioData.deposit;
    document.getElementById('propertyInput').value = portfolioData.property;
    document.getElementById('cryptoInput').value = portfolioData.crypto;
    document.getElementById('otherInput').value = portfolioData.other;
    
    // Calculate initial portfolio
    calculatePortfolio();
    
    // Calculate button
    document.getElementById('calculateBtn').addEventListener('click', calculatePortfolio);
    
    // Reset button
    document.getElementById('resetBtn').addEventListener('click', function() {
        document.getElementById('ihsgInput').value = portfolioData.ihsg;
        document.getElementById('goldInput').value = portfolioData.gold;
        document.getElementById('mutualInput').value = portfolioData.mutual;
        document.getElementById('bondInput').value = portfolioData.bonds;
        document.getElementById('depositInput').value = portfolioData.deposit;
        document.getElementById('propertyInput').value = portfolioData.property;
        document.getElementById('cryptoInput').value = portfolioData.crypto;
        document.getElementById('otherInput').value = portfolioData.other;
        calculatePortfolio();
    });
    
    // Real-time gold price updates
    simulateGoldPrice(); // Initial update
    setInterval(simulateGoldPrice, 30000); // Update every 30 seconds
    
    // Real-time chart updates
    setInterval(updateGoldChart, 2000); // Update chart every 2 seconds
});

// Navigation scroll effect
window.addEventListener('scroll', function() {
    const nav = document.getElementById('siteNav');
    if (window.scrollY > 50) {
        nav.classList.add('glass');
    } else {
        nav.classList.remove('glass');
    }
});

// News API Configuration
const NEWS_API_KEY = 'be3a2bd71379467cb4b6e3c589c4d37e'; // Ganti dengan API key Anda dari https://newsapi.org/
const NEWS_API_URL = 'https://newsapi.org/v2';

// News cache untuk performance
let newsCache = {
    indonesia: [],
    worldwide: [],
    all: [],
    lastUpdated: null
};

// Fetch news dari API
async function fetchEconomicNews(country = 'all') {
    const newsContainer = document.getElementById('newsContainer');
    const newsLoading = document.getElementById('newsLoading');
    const newsError = document.getElementById('newsError');
    
    newsLoading.style.display = 'block';
    newsError.style.display = 'none';
    newsContainer.innerHTML = '';
    
    try {
        let articles = [];
        
        if (country === 'indonesia') {
            // Berita Indonesia - menggunakan query spesifik
            const queries = ['ekonomi Indonesia', 'saham IHSG', 'investasi Indonesia', 'Rupiah', 'BI rate'];
            
            for (const query of queries) {
                const response = await fetch(
                    `${NEWS_API_URL}/everything?q=${query}&language=id&sortBy=publishedAt&pageSize=5&apiKey=${NEWS_API_KEY}`
                );
                
                if (response.ok) {
                    const data = await response.json();
                    articles = articles.concat(data.articles);
                }
                
                // Delay untuk avoid rate limit
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            // Filter duplicate articles
            articles = articles.filter((article, index, self) =>
                index === self.findIndex((t) => t.title === article.title)
            );
            
        } else if (country === 'worldwide') {
            // Berita Global - business & finance
            const response = await fetch(
                `${NEWS_API_URL}/top-headlines?category=business&sortBy=publishedAt&pageSize=15&apiKey=${NEWS_API_KEY}`
            );
            
            if (response.ok) {
                const data = await response.json();
                articles = data.articles;
            }
            
        } else {
            // Semua berita - kombinasi Indonesia + Global
            const [indonesiaRes, globalRes] = await Promise.all([
                fetch(`${NEWS_API_URL}/everything?q=ekonomi&language=id&sortBy=publishedAt&pageSize=10&apiKey=${NEWS_API_KEY}`),
                fetch(`${NEWS_API_URL}/top-headlines?category=business&sortBy=publishedAt&pageSize=10&apiKey=${NEWS_API_KEY}`)
            ]);
            
            if (indonesiaRes.ok && globalRes.ok) {
                const indonesiaData = await indonesiaRes.json();
                const globalData = await globalRes.json();
                articles = [...indonesiaData.articles, ...globalData.articles];
            }
        }
        
        // Cache hasil
        newsCache[country] = articles.slice(0, 12); // Ambil max 12 articles
        newsCache.lastUpdated = new Date();
        
        // Update UI
        displayNews(articles.slice(0, 12), country);
        updateLastUpdatedTime();
        
        newsLoading.style.display = 'none';
        
    } catch (error) {
        console.error('Error fetching news:', error);
        newsLoading.style.display = 'none';
        newsError.style.display = 'block';
    }
}

// Display news cards
function displayNews(articles, category) {
    const newsContainer = document.getElementById('newsContainer');
    
    if (articles.length === 0) {
        newsContainer.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 40px; background: var(--glass-bg); border-radius: 16px;">
                <i class="bi bi-newspaper" style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 20px;"></i>
                <p style="color: var(--text-secondary); font-size: 1.1rem;">Tidak ada berita terbaru</p>
            </div>
        `;
        return;
    }
    
    let html = '';
    
    articles.forEach((article, index) => {
        // Format date
        const date = new Date(article.publishedAt);
        const timeAgo = getTimeAgo(date);
        const isBreaking = index < 3 && Math.random() > 0.7; // Random breaking news
        
        // Determine category tag
        const isIndonesia = article.description?.toLowerCase().includes('indonesia') || 
                           article.title?.toLowerCase().includes('indonesia') ||
                           article.source.name?.toLowerCase().includes('indonesia');
        
        const categoryTag = isIndonesia ? 'üáÆüá© Indonesia' : 'üåç Global';
        const categoryClass = isIndonesia ? 'news-category-indonesia' : 'news-category-global';
        
        // Extract keywords/tags
        const tags = extractTags(article.title, article.description);
        
        html += `
            <div class="news-card">
                ${isBreaking ? '<div class="news-breaking">BREAKING</div>' : ''}
                
                <div class="news-header">
                    <div>
                        <div class="news-source ${categoryClass}">
                            <i class="bi bi-${isIndonesia ? 'flag' : 'globe'}"></i>
                            ${article.source.name || 'Unknown Source'}
                        </div>
                        <div class="news-time">${timeAgo}</div>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.05); color: var(--text-secondary); padding: 6px 12px; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">
                        ${categoryTag}
                    </div>
                </div>
                
                <h3 class="news-title">${article.title}</h3>
                
                <p class="news-description">
                    ${article.description || 'Tidak ada deskripsi tersedia.'}
                </p>
                
                <div class="news-footer">
                    <div class="news-tags">
                        ${tags.map(tag => `<span class="news-tag">${tag}</span>`).join('')}
                    </div>
                    <a href="${article.url}" target="_blank" class="news-read-more">
                        Baca Selengkapnya <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
            </div>
        `;
    });
    
    newsContainer.innerHTML = html;
}

// Helper function untuk format waktu
function getTimeAgo(date) {
    const seconds = Math.floor((new Date() - date) / 1000);
    
    let interval = seconds / 31536000;
    if (interval > 1) return Math.floor(interval) + ' tahun lalu';
    
    interval = seconds / 2592000;
    if (interval > 1) return Math.floor(interval) + ' bulan lalu';
    
    interval = seconds / 86400;
    if (interval > 1) return Math.floor(interval) + ' hari lalu';
    
    interval = seconds / 3600;
    if (interval > 1) return Math.floor(interval) + ' jam lalu';
    
    interval = seconds / 60;
    if (interval > 1) return Math.floor(interval) + ' menit lalu';
    
    return Math.floor(seconds) + ' detik lalu';
}

// Extract tags dari title & description
function extractTags(title, description) {
    const text = (title + ' ' + (description || '')).toLowerCase();
    const tags = [];
    const keywords = {
        'saham': ['saham', 'ihsg', 'stock', 'bursa efek', 'idx'],
        'ekonomi': ['ekonomi', 'economy', 'pertumbuhan', 'gdp', 'inflasi'],
        'investasi': ['investasi', 'investment', 'modal', 'dana', 'portofolio'],
        'crypto': ['bitcoin', 'crypto', 'cryptocurrency', 'ethereum', 'blockchain'],
        'emas': ['emas', 'gold', 'antam', 'logam mulia'],
        'properti': ['properti', 'property', 'real estate', 'rumah', 'tanah'],
        'obligasi': ['obligasi', 'bond', 'surat utang', 'SUN', 'SBSN'],
        'bank': ['bank', 'perbankan', 'BI', 'bunga', 'kredit']
    };
    
    for (const [tag, words] of Object.entries(keywords)) {
        if (words.some(word => text.includes(word))) {
            tags.push(tag.charAt(0).toUpperCase() + tag.slice(1));
            if (tags.length >= 3) break;
        }
    }
    
    return tags.length > 0 ? tags : ['Berita'];
}

// Update last updated time display
function updateLastUpdatedTime() {
    const lastUpdatedTime = document.getElementById('lastUpdatedTime');
    if (newsCache.lastUpdated) {
        const time = newsCache.lastUpdated.toLocaleTimeString('id-ID', {
            hour: '2-digit',
            minute: '2-digit'
        });
        lastUpdatedTime.textContent = `Last updated: ${time}`;
    }
}

// Auto-refresh news setiap 5 menit
function setupAutoRefresh() {
    // Initial load
    fetchEconomicNews('indonesia');
    
    // Auto refresh setiap 5 menit (300000 ms)
    setInterval(() => {
        const activeBtn = document.querySelector('.btn.active');
        const category = activeBtn?.id === 'newsWorldwideBtn' ? 'worldwide' : 
                        activeBtn?.id === 'newsAllBtn' ? 'all' : 'indonesia';
        fetchEconomicNews(category);
    }, 300000); // 5 minutes
}

// Event Listeners untuk buttons
document.addEventListener('DOMContentLoaded', function() {
    // ... existing code ...
    
    // Setup news buttons
    const newsIndonesiaBtn = document.getElementById('newsIndonesiaBtn');
    const newsWorldwideBtn = document.getElementById('newsWorldwideBtn');
    const newsAllBtn = document.getElementById('newsAllBtn');
    const refreshNewsBtn = document.getElementById('refreshNewsBtn');
    const retryNewsBtn = document.getElementById('retryNewsBtn');
    
    // Button click handlers
    newsIndonesiaBtn.addEventListener('click', () => {
        setActiveButton(newsIndonesiaBtn);
        if (newsCache.indonesia.length > 0) {
            displayNews(newsCache.indonesia, 'indonesia');
            updateLastUpdatedTime();
        } else {
            fetchEconomicNews('indonesia');
        }
    });
    
    newsWorldwideBtn.addEventListener('click', () => {
        setActiveButton(newsWorldwideBtn);
        if (newsCache.worldwide.length > 0) {
            displayNews(newsCache.worldwide, 'worldwide');
            updateLastUpdatedTime();
        } else {
            fetchEconomicNews('worldwide');
        }
    });
    
    newsAllBtn.addEventListener('click', () => {
        setActiveButton(newsAllBtn);
        if (newsCache.all.length > 0) {
            displayNews(newsCache.all, 'all');
            updateLastUpdatedTime();
        } else {
            fetchEconomicNews('all');
        }
    });
    
    refreshNewsBtn.addEventListener('click', () => {
        const activeBtn = document.querySelector('.btn.active');
        const category = activeBtn?.id === 'newsWorldwideBtn' ? 'worldwide' : 
                        activeBtn?.id === 'newsAllBtn' ? 'all' : 'indonesia';
        fetchEconomicNews(category);
    });
    
    retryNewsBtn.addEventListener('click', () => {
        const activeBtn = document.querySelector('.btn.active');
        const category = activeBtn?.id === 'newsWorldwideBtn' ? 'worldwide' : 
                        activeBtn?.id === 'newsAllBtn' ? 'all' : 'indonesia';
        fetchEconomicNews(category);
    });
    
    // Set default active button
    setActiveButton(newsIndonesiaBtn);
    
    // Setup auto refresh
    setupAutoRefresh();
});

// Helper function untuk set active button
function setActiveButton(activeBtn) {
    document.querySelectorAll('.btn').forEach(btn => btn.classList.remove('active'));
    activeBtn.classList.add('active');
}

// Logout functionality
function logout() {
    if (confirm('Are you sure you want to logout?')) {
        localStorage.clear();
        window.location.href = 'index.html';
    }
}

// Add logout button to navigation if needed
document.addEventListener('DOMContentLoaded', function() {
    // You can add a logout button to the nav here if needed
    console.log('Financial page loaded - User authenticated');
});
</script>
</body>
</html>